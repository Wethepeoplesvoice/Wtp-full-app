<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>We The People's Voice ‚Äì Full App</title>
  <style>
    :root {
      --bg: #020617;
      --card: #02091c;
      --card-soft: #061529;
      --accent: #22c55e;
      --accent-soft: rgba(34, 197, 94, 0.12);
      --accent-strong: #16a34a;
      --text-main: #e5e7eb;
      --text-muted: #9ca3af;
      --danger: #f97373;
      --border-subtle: rgba(148, 163, 184, 0.28);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #0b1220 0, #020617 40%, #000 100%);
      color: var(--text-main);
      min-height: 100vh;
    }

    .page-wrap {
      max-width: 1100px;
      margin: 0 auto;
      padding: 1.25rem 1.25rem 4rem;
    }

    .pill-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      align-items: center;
      margin-bottom: 0.75rem;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      padding: 0.2rem 0.75rem;
      border-radius: 999px;
      font-size: 0.8rem;
      letter-spacing: 0.05em;
      text-transform: uppercase;
      border: 1px solid rgba(148, 163, 184, 0.4);
      color: var(--text-muted);
      background: rgba(15, 23, 42, 0.9);
    }

    .pill-dot {
      width: 0.5rem;
      height: 0.5rem;
      border-radius: 999px;
      background: #22c55e;
      box-shadow: 0 0 12px rgba(34, 197, 94, 0.9);
    }

    .btn-pill-main {
      border: none;
      cursor: pointer;
      background: #16a34a;
      color: #022c22;
      font-weight: 600;
      padding: 0.35rem 0.95rem;
      border-radius: 999px;
      font-size: 0.82rem;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      box-shadow: 0 0 18px rgba(22, 163, 74, 0.6);
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }

    .btn-pill-main span.icon {
      font-size: 1rem;
    }

    header.hero {
      border-radius: 1.5rem;
      padding: 1.5rem 1.4rem 1.6rem;
      margin-bottom: 1.25rem;
      background: radial-gradient(circle at top left, #1d283a 0, #020617 40%, #020617 75%);
      box-shadow:
        0 0 0 1px rgba(148, 163, 184, 0.35),
        0 28px 80px rgba(15, 23, 42, 0.95);
      border: 1px solid rgba(148, 163, 184, 0.25);
    }

    .hero-grid {
      display: grid;
      grid-template-columns: minmax(0, 2.2fr) minmax(0, 1.6fr);
      gap: 1.75rem;
      align-items: stretch;
    }

    @media (max-width: 800px) {
      .hero-grid {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .hero-title {
      font-size: clamp(2.0rem, 4vw, 2.7rem);
      font-weight: 800;
      line-height: 1.05;
      letter-spacing: 0.04em;
      margin-bottom: 0.65rem;
    }

    .hero-subtitle {
      color: var(--text-muted);
      font-size: 0.98rem;
      max-width: 30rem;
      margin-bottom: 1.2rem;
    }

    .hero-subtitle strong {
      color: #e5e7eb;
    }

    .hero-points {
      list-style: none;
      display: grid;
      gap: 0.4rem;
      font-size: 0.88rem;
    }

    .hero-points li {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      color: var(--text-muted);
    }

    .hero-points span.bullet {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 1.1rem;
      height: 1.1rem;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      font-size: 0.65rem;
    }

    .hero-right {
      border-radius: 1.2rem;
      padding: 1.1rem 1.1rem 1.1rem;
      background:
        radial-gradient(circle at top, rgba(34, 197, 94, 0.22) 0, transparent 45%),
        radial-gradient(circle at bottom right, rgba(59, 130, 246, 0.18) 0, transparent 45%),
        rgba(15, 23, 42, 0.98);
      border: 1px solid rgba(148, 163, 184, 0.35);
      display: flex;
      flex-direction: column;
      gap: 0.6rem;
    }

    .hero-right h3 {
      font-size: 0.95rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: var(--text-muted);
    }

    .hero-right p {
      font-size: 0.9rem;
      color: var(--text-main);
    }

    .hero-right ul {
      list-style: none;
      display: grid;
      gap: 0.4rem;
      font-size: 0.82rem;
      color: var(--text-muted);
    }

    .hero-right strong {
      color: var(--text-main);
    }

    .hero-tagline {
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: rgba(148, 163, 184, 0.9);
    }

    .stack {
      display: grid;
      gap: 1rem;
    }

    .card {
      border-radius: 1.2rem;
      padding: 1rem 1rem 1rem;
      border: 1px solid rgba(148, 163, 184, 0.3);
      background: radial-gradient(circle at top left, rgba(15, 23, 42, 0.9) 0, rgba(15, 23, 42, 0.98) 40%, #020617 100%);
      box-shadow: 0 16px 40px rgba(15, 23, 42, 0.85);
    }

    .card-header-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 0.6rem;
    }

    .card-title {
      font-size: 1rem;
      font-weight: 600;
    }

    .card-subtitle {
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    .filter-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      align-items: center;
      margin-bottom: 0.4rem;
    }

    select, input[type="text"], textarea {
      width: 100%;
      border-radius: 999px;
      padding: 0.5rem 0.75rem;
      border: 1px solid var(--border-subtle);
      background: rgba(15, 23, 42, 0.9);
      color: var(--text-main);
      font-size: 0.9rem;
      outline: none;
    }

    textarea {
      border-radius: 0.9rem;
      min-height: 120px;
      resize: vertical;
    }

    select:focus,
    input[type="text"]:focus,
    textarea:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(34, 197, 94, 0.5);
    }

    label {
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: var(--text-muted);
    }

    .field-group {
      margin-bottom: 0.6rem;
    }

    .chips-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.4rem;
      margin-top: 0.3rem;
    }

    .chip {
      border-radius: 999px;
      padding: 0.15rem 0.55rem;
      font-size: 0.78rem;
      border: 1px solid rgba(148, 163, 184, 0.4);
      color: var(--text-muted);
      cursor: pointer;
    }

    .chip.active {
      background: rgba(34, 197, 94, 0.16);
      color: var(--accent);
      border-color: rgba(34, 197, 94, 0.9);
    }

    .btn-primary {
      margin-top: 0.25rem;
      border-radius: 999px;
      border: none;
      padding: 0.55rem 1rem;
      font-weight: 600;
      font-size: 0.9rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      background: linear-gradient(135deg, #22c55e, #4ade80);
      color: #022c22;
      box-shadow: 0 12px 30px rgba(34, 197, 94, 0.55);
    }

    .btn-primary:active {
      transform: translateY(1px);
      box-shadow: 0 6px 18px rgba(34, 197, 94, 0.6);
    }

    .btn-secondary {
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.55);
      padding: 0.4rem 0.75rem;
      font-size: 0.8rem;
      background: rgba(15, 23, 42, 0.8);
      color: var(--text-muted);
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      cursor: pointer;
    }

    .layout-two {
      display: grid;
      grid-template-columns: minmax(0, 1.35fr) minmax(0, 1.1fr);
      gap: 1rem;
      margin-top: 0.75rem;
    }

    @media (max-width: 900px) {
      .layout-two {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .issue-list {
      display: grid;
      gap: 0.65rem;
      margin-top: 0.4rem;
    }

    .issue-card {
      border-radius: 0.9rem;
      padding: 0.7rem 0.8rem;
      background: radial-gradient(circle at top left, rgba(15, 23, 42, 0.95) 0, #020617 50%);
      border: 1px solid rgba(148, 163, 184, 0.35);
      display: grid;
      grid-template-columns: auto minmax(0, 1fr);
      gap: 0.75rem;
    }

    @media (max-width: 600px) {
      .issue-card {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .vote-column {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.15rem;
      padding-right: 0.35rem;
      border-right: 1px solid rgba(31, 41, 55, 0.9);
    }

    @media (max-width: 600px) {
      .vote-column {
        flex-direction: row;
        justify-content: flex-start;
        border-right: none;
        border-bottom: 1px solid rgba(31, 41, 55, 0.9);
        padding-bottom: 0.3rem;
        margin-bottom: 0.25rem;
      }
    }

    .vote-btn {
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.5);
      background: rgba(15, 23, 42, 0.9);
      color: var(--text-muted);
      width: 1.5rem;
      height: 1.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.9rem;
      cursor: pointer;
    }

    .vote-score {
      font-weight: 700;
      font-size: 1.15rem;
    }

    .issue-main {
      display: grid;
      gap: 0.3rem;
    }

    .issue-header-line {
      display: flex;
      justify-content: space-between;
      gap: 0.5rem;
      align-items: center;
    }

    .issue-title {
      font-weight: 600;
      font-size: 0.98rem;
    }

    .badge-scope {
      border-radius: 999px;
      padding: 0.15rem 0.6rem;
      font-size: 0.72rem;
      text-transform: uppercase;
      letter-spacing: 0.13em;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.45);
      color: var(--text-muted);
    }

    .badge-scope[data-scope="National"] {
      border-color: rgba(34, 197, 94, 0.9);
      color: #bbf7d0;
      background: rgba(22, 101, 52, 0.55);
    }

    .badge-scope[data-scope="State"] {
      border-color: rgba(59, 130, 246, 0.9);
      color: #bfdbfe;
      background: rgba(30, 64, 175, 0.55);
    }

    .badge-scope[data-scope="Local"] {
      border-color: rgba(251, 191, 36, 0.95);
      color: #fef9c3;
      background: rgba(180, 83, 9, 0.55);
    }

    .issue-meta {
      font-size: 0.78rem;
      color: var(--text-muted);
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }

    .issue-body {
      font-size: 0.88rem;
      color: #e5e7eb;
    }

    .issue-tags {
      margin-top: 0.2rem;
      display: flex;
      flex-wrap: wrap;
      gap: 0.3rem;
    }

    .issue-tag {
      font-size: 0.72rem;
      padding: 0.16rem 0.45rem;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.45);
      color: var(--text-muted);
    }

    .issue-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 0.5rem;
      margin-top: 0.2rem;
      font-size: 0.78rem;
    }

    .status-chip {
      padding: 0.16rem 0.55rem;
      border-radius: 999px;
      font-size: 0.72rem;
      border: 1px solid rgba(148, 163, 184, 0.7);
      color: var(--text-muted);
    }

    .status-chip.ready {
      border-color: rgba(34, 197, 94, 0.85);
      background: rgba(22, 163, 74, 0.22);
      color: #bbf7d0;
    }

    .status-chip.draft {
      border-style: dashed;
    }

    .status-chip.threshold-low {
      border-color: rgba(251, 191, 36, 0.7);
      color: #fcd34d;
    }

    .stats-box {
      font-size: 0.8rem;
      color: var(--text-muted);
      padding: 0.6rem 0.7rem;
      border-radius: 0.9rem;
      background: rgba(15, 23, 42, 0.95);
      border: 1px dashed rgba(148, 163, 184, 0.5);
      display: grid;
      gap: 0.2rem;
    }

    footer.page-footer {
      margin-top: 1.2rem;
      font-size: 0.76rem;
      color: var(--text-muted);
      text-align: center;
    }

    .danger-note {
      font-size: 0.78rem;
      color: rgba(252, 165, 165, 0.9);
      margin-top: 0.12rem;
    }

    .small-label-row {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
    }

    .tiny {
      font-size: 0.72rem;
      color: var(--text-muted);
    }

    .hidden {
      display: none !important;
    }
  </style>
</head>
<body>
  <div class="page-wrap">
    <!-- HERO / HEADER -->
    <header class="hero">
      <div class="pill-row">
        <div class="pill">
          <span class="pill-dot"></span>
          LIVE GRASSROOTS PROTOTYPE
        </div>
        <button class="btn-pill-main" type="button">
          <span class="icon">‚öñÔ∏è</span>
          GRASSROOTS CIVIC APP
        </button>
      </div>

      <div class="hero-grid">
        <div>
          <div class="hero-tagline">WE THE PEOPLE'S VOICE</div>
          <h1 class="hero-title">Vote. Your power. We The People will be heard.</h1>
          <p class="hero-subtitle">
            This full app lets anyone draft a clear, one-page idea and see how people would vote on it.
            Later, verified support can be turned into <strong>formal petitions and proposals</strong> that are
            delivered to Congress and state leaders.
          </p>
          <ul class="hero-points">
            <li><span class="bullet">1</span> Write one-page proposals in plain language.</li>
            <li><span class="bullet">2</span> Let people vote ideas up or down without party labels.</li>
            <li><span class="bullet">3</span> Turn high-support ideas into real petitions and draft bills.</li>
          </ul>
        </div>

        <div class="hero-right">
          <h3>What this prototype does today</h3>
          <p>
            Everything happens <strong>only in your browser</strong> for now. It‚Äôs a safe place to practice writing
            proposals and see how different ideas might perform with voters.
          </p>
          <ul>
            <li>‚úÖ Create issues with a title, scope, tags, and a simple ‚Äúbill‚Äù explanation.</li>
            <li>‚úÖ Vote ideas up or down to see what gains support.</li>
            <li>‚úÖ Track when issues cross support thresholds (for future petitions).</li>
          </ul>
          <p class="hero-tagline">
            Next step: connect verified U.S. citizens and generate legally formatted submissions.
          </p>
        </div>
      </div>
    </header>

    <div class="stack">
      <!-- LIVE ISSUES + VOTES -->
<section class="card">
    <div class="card-header-row">
        <div>
            <div class="card-title">Live Issues & Votes</div>
            <div class="card-subtitle">
                See the questions you've created and practice voting them up or down.
            </div>
        </div>
        <button class="btn-secondary" onclick="clearAllIssues()">
            üßπ Clear all issues (local test)
        </button>
    </div>

    <div class="layout-two">

        <!-- FILTERS -->
        <div>
            <div class="filter-row">
                <label for="scopeFilter">Showing issues:</label>
                <select id="scopeFilter" onchange="renderIssues()">
                    <option value="All">All ‚Äì national & local</option>
                    <option value="National">National</option>
                    <option value="State">State</option>
                    <option value="Local">Local</option>
                </select>
            </div>

            <div id="issuesEmptyMsg" class="muted">
                No issues yet. Scroll down and create the first one.
            </div>

            <!-- ISSUES LIST -->
            <div id="issuesList" class="stack"></div>
        </div>

        <!-- STATS -->
        <div id="statsBox">
            <h3>Support Stats</h3>
            <p class="muted small">
                Track upvotes, downvotes, and when items cross support thresholds.
            </p>

            <div class="stat-block">
                <strong>Total Issues:</strong>
                <span id="statTotalIssues">0</span>
            </div>

            <div class="stat-block">
                <strong>Highest Support:</strong>
                <span id="statTopSupport">0%</span>
            </div>

            <div class="stat-block">
                <strong>Most Supported Issue:</strong>
                <span id="statTopIssue">None yet</span>
            </div>
        </div>

    </div>
</section>
      <section class="card">
        <div class="card-header-row">
          <div>
            <div class="card-title">Create a new issue to vote on</div>
            <div class="card-subtitle">
              One page, one idea. Draft your proposal and let people vote it up or down.
            </div>
          </div>
          <button class="btn-secondary" id="loadTermLimitsExampleBtn" type="button">
            üìÑ Load term-limits example
          </button>
        </div>

        <form id="issueForm">
          <div class="layout-two">
            <!-- LEFT FORM COLUMN -->
            <div>
              <div class="field-group">
                <div class="small-label-row">
                  <label for="issueTitle">Issue title*</label>
                  <span class="tiny">Keep it clear and focused.</span>
                </div>
                <input
                  id="issueTitle"
                  type="text"
                  placeholder="Example: Term limits for members of Congress"
                  required
                />
              </div>

              <div class="field-group">
                <div class="small-label-row">
                  <label for="issueScope">Where does this apply?*</label>
                </div>
                <select id="issueScope" required>
                  <option value="National">National (U.S.-wide)</option>
                  <option value="State">State-level</option>
                  <option value="Local">Local / city / county</option>
                </select>
              </div>

              <div class="field-group">
                <div class="small-label-row">
                  <label>How should we think about this?</label>
                  <span class="tiny">Pick up to 3 tags.</span>
                </div>
                <div class="chips-row" id="tagChipsRow">
                  <button type="button" class="chip" data-tag="No party labels">No party labels</button>
                  <button type="button" class="chip" data-tag="Checks & balances">Checks &amp; balances</button>
                  <button type="button" class="chip" data-tag="Article V style reform">Article V style reform</button>
                  <button type="button" class="chip" data-tag="Anti-corruption">Anti-corruption</button>
                  <button type="button" class="chip" data-tag="Election reform">Election reform</button>
                  <button type="button" class="chip" data-tag="Fiscal responsibility">Fiscal responsibility</button>
                </div>
              </div>
            </div>

            <!-- RIGHT FORM COLUMN -->
            <div>
              <div class="field-group">
                <div class="small-label-row">
                  <label for="issueBody">What are you asking for?*</label>
                  <span class="tiny">
                    Describe the change, why it matters, and what action you want Congress or your state to take.
                  </span>
                </div>
                <textarea
                  id="issueBody"
                  placeholder="This is your simple, plain-language one-page ‚Äòbill‚Äô."
                  required
                ></textarea>
              </div>

              <div class="field-group">
                <div class="small-label-row">
                  <label for="issueExtraTags">Optional tags / key points</label>
                  <span class="tiny">Separate tags with commas.</span>
                </div>
                <input
                  id="issueExtraTags"
                  type="text"
                  placeholder="Example: term limits, corruption, campaign finance, citizen power"
                />
              </div>

              <button class="btn-primary" type="submit">
                <span>‚ûï Publish issue for voting (local test)</span>
              </button>
              <div class="danger-note">
                Reminder: this is a grassroots movement tool. It does not replace voting in real elections. It is a way
                for citizens to show what they want changed and give Congress and state leaders a clear mandate from
                We The People.
              </div>
            </div>
          </div>
        </form>
      </section>

      <footer class="page-footer">
        Built as a grassroots prototype by and for citizens who believe that the government should work for the people
        again. When enough of us stand up behind a clear idea, it becomes a mandate they cannot ignore.
      </footer>
    </div>
  </div>

  <script>
    // ---- Simple local-storage based grassroots app ----
    const STORAGE_KEY = "wtp_full_app_issues_v1";

    function loadIssues() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return [];
        const parsed = JSON.parse(raw);
        if (!Array.isArray(parsed)) return [];
        return parsed;
      } catch (e) {
        console.error("Failed to load issues", e);
        return [];
      }
    }

    function saveIssues(issues) {
      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(issues));
      } catch (e) {
        console.error("Failed to save issues", e);
      }
    }

    function createIssueId() {
      return "issue_" + Date.now() + "_" + Math.random().toString(16).slice(2);
    }

    function getSelectedTags() {
      return Array.from(document.querySelectorAll(".chip.active")).map((c) =>
        c.getAttribute("data-tag")
      );
    }

    function buildIssueFromForm() {
      const titleEl = document.getElementById("issueTitle");
      const scopeEl = document.getElementById("issueScope");
      const bodyEl = document.getElementById("issueBody");
      const extraTagsEl = document.getElementById("issueExtraTags");

      const title = titleEl.value.trim();
      const scope = scopeEl.value;
      const body = bodyEl.value.trim();
      const selectedTagChips = getSelectedTags();

      if (!title || !body) {
        alert("Please fill in the title and what you are asking for.");
        return null;
      }

      let extraTags = [];
      if (extraTagsEl.value.trim()) {
        extraTags = extraTagsEl.value
          .split(",")
          .map((s) => s.trim())
          .filter(Boolean);
      }

      const now = new Date();
      const createdAt = now.toISOString();
      const tagSet = [...selectedTagChips, ...extraTags];

      return {
        id: createIssueId(),
        title,
        scope,
        body,
        tags: tagSet,
        votesUp: 0,
        votesDown: 0,
        createdAt,
        by: "You (local)",
      };
    }

    function voteOnIssue(id, deltaUp, deltaDown) {
      const issues = loadIssues();
      const idx = issues.findIndex((i) => i.id === id);
      if (idx === -1) return;
      const issue = issues[idx];
      issue.votesUp = Math.max(0, (issue.votesUp || 0) + deltaUp);
      issue.votesDown = Math.max(0, (issue.votesDown || 0) + deltaDown);
      issues[idx] = issue;
      saveIssues(issues);
      render();
    }

    function formatDate(dateStr) {
      const d = new Date(dateStr);
      if (isNaN(d)) return "";
      return d.toLocaleDateString(undefined, {
        month: "short",
        day: "numeric",
        year: "numeric",
      });
    }

    function computeStatus(issue) {
      const totalVotes = (issue.votesUp || 0) + (issue.votesDown || 0);
      const netScore = (issue.votesUp || 0) - (issue.votesDown || 0);
      const readyThreshold = 25; // local test
      const warningThreshold = 10;

      if (totalVotes === 0) {
        return {
          label: "Draft ‚Äì not voted on yet",
          class: "draft",
        };
      }

      if (netScore >= readyThreshold) {
        return {
          label: "Ready for petition draft (local threshold reached)",
          class: "ready",
        };
      }

      if (netScore >= warningThreshold) {
        return {
          label: "Gaining traction ‚Äì keep sharing",
          class: "threshold-low",
        };
      }

      if (netScore <= 0 && totalVotes >= 5) {
        return {
          label: "Needs revision ‚Äì more down-votes than up-votes",
          class: "threshold-low",
        };
      }

      return {
        label: "Early voting ‚Äì still forming",
        class: "",
      };
    }

    function renderIssues() {
      const issues = loadIssues();
      const listEl = document.getElementById("issueList");
      const emptyMsg = document.getElementById("issuesEmptyMsg");
      const filter = document.getElementById("scopeFilter").value;

      listEl.innerHTML = "";

      const filtered = issues.filter((issue) => {
        if (filter === "All") return true;
        return issue.scope === filter;
      });

      if (filtered.length === 0) {
        emptyMsg.classList.remove("hidden");
        return;
      }

      emptyMsg.classList.add("hidden");

      filtered
        .slice()
        .sort((a, b) => {
          const scoreA = (b.votesUp || 0) - (b.votesDown || 0);
          const scoreB = (a.votesUp || 0) - (a.votesDown || 0);
          return scoreA - scoreB;
        })
        .forEach((issue) => {
          const totalVotes = (issue.votesUp || 0) + (issue.votesDown || 0);
          const netScore = (issue.votesUp || 0) - (issue.votesDown || 0);
          const status = computeStatus(issue);

          const card = document.createElement("article");
          card.className = "issue-card";

          const voteCol = document.createElement("div");
          voteCol.className = "vote-column";
          voteCol.innerHTML = `
            <button class="vote-btn" data-id="${issue.id}" data-dir="up">‚ñ≤</button>
            <div class="vote-score">${netScore}</div>
            <button class="vote-btn" data-id="${issue.id}" data-dir="down">‚ñº</button>
          `;

          const main = document.createElement("div");
          main.className = "issue-main";

          const headerLine = document.createElement("div");
          headerLine.className = "issue-header-line";
          headerLine.innerHTML = `
            <div class="issue-title">${issue.title}</div>
            <span class="badge-scope" data-scope="${issue.scope}">${issue.scope}</span>
          `;

          const meta = document.createElement("div");
          meta.className = "issue-meta";
          meta.textContent = `Created ${formatDate(issue.createdAt)} ‚Ä¢ By: ${issue.by} ‚Ä¢ Votes: ${totalVotes}`;

          const body = document.createElement("div");
          body.className = "issue-body";
          body.textContent = issue.body;

          const tagsDiv = document.createElement("div");
          tagsDiv.className = "issue-tags";
          (issue.tags || []).forEach((t) => {
            const span = document.createElement("span");
            span.className = "issue-tag";
            span.textContent = t;
            tagsDiv.appendChild(span);
          });

          const footer = document.createElement("div");
          footer.className = "issue-footer";
          footer.innerHTML = `
            <span class="status-chip ${status.class}">${status.label}</span>
            <span class="tiny">Net score: ${netScore} ‚Ä¢ Up: ${issue.votesUp || 0} ‚Ä¢ Down: ${issue.votesDown || 0}</span>
          `;

          main.appendChild(headerLine);
          main.appendChild(meta);
          main.appendChild(body);
          if ((issue.tags || []).length > 0) main.appendChild(tagsDiv);
          main.appendChild(footer);

          card.appendChild(voteCol);
          card.appendChild(main);

          listEl.appendChild(card);
        });

      listEl.querySelectorAll(".vote-btn").forEach((btn) => {
        btn.addEventListener("click", () => {
          const id = btn.getAttribute("data-id");
          const dir = btn.getAttribute("data-dir");
          if (dir === "up") {
            voteOnIssue(id, 1, 0);
          } else {
            voteOnIssue(id, 0, 1);
          }
        });
      });
    }

    function renderStats() {
      const issues = loadIssues();
      const statsLines = document.getElementById("statsLines");

      if (issues.length === 0) {
        statsLines.textContent = "No issues have been created yet. Start by drafting a proposal below.";
        return;
      }

      const total = issues.length;
      const totalUp = issues.reduce((sum, i) => sum + (i.votesUp || 0), 0);
      const totalDown = issues.reduce((sum, i) => sum + (i.votesDown || 0), 0);
      const readyCount = issues.filter(
        (i) => computeStatus(i).class === "ready"
      ).length;

      statsLines.innerHTML = `
        You‚Äôve created <strong>${total}</strong> issue${total === 1 ? "" : "s"} on this device so far.
        Together they‚Äôve collected <strong>${totalUp}</strong> up-votes and <strong>${totalDown}</strong> down-votes.
        <br />
        <strong>${readyCount}</strong> issue${readyCount === 1 ? " is" : "s are"} above the local ‚Äúready for petition‚Äù threshold.
      `;
    }

    function render() {
      renderIssues();
      renderStats();
    }

    function resetForm() {
      document.getElementById("issueForm").reset();
      document.querySelectorAll(".chip").forEach((chip) =>
        chip.classList.remove("active")
      );
    }

    function installTagChipHandlers() {
      const chips = document.querySelectorAll(".chip");
      chips.forEach((chip) => {
        chip.addEventListener("click", () => {
          if (chip.classList.contains("active")) {
            chip.classList.remove("active");
            return;
          }
          const active = Array.from(chips).filter((c) =>
            c.classList.contains("active")
          );
          if (active.length >= 3) {
            alert("You can select up to three main tags.");
            return;
          }
          chip.classList.add("active");
        });
      });
    }

    function loadTermLimitsExample() {
      document.getElementById("issueTitle").value =
        "Term limits for members of Congress";
      document.getElementById("issueScope").value = "National";
      document.getElementById("issueBody").value =
        "Set clear, reasonable term limits for members of the U.S. House and Senate so that public service is not a lifetime career. " +
        "The goal is to reduce entrenched power, limit corruption, and make room for new voices who are closer to everyday American life. " +
        "This measure would cap the number of years any one person can serve in each chamber and would phase in over time so voters and candidates can prepare.";
      document.getElementById("issueExtraTags").value =
        "term limits, corruption, career politicians, citizen power";

      document.querySelectorAll(".chip").forEach((chip) =>
        chip.classList.remove("active")
      );
      const desired = [
        "No party labels",
        "Article V style reform",
        "Anti-corruption",
      ];
      document.querySelectorAll(".chip").forEach((chip) => {
        if (desired.includes(chip.getAttribute("data-tag"))) {
          chip.classList.add("active");
        }
      });
    }

    function installFormHandler() {
      const form = document.getElementById("issueForm");
      form.addEventListener("submit", (e) => {
        e.preventDefault();
        const issue = buildIssueFromForm();
        if (!issue) return;
        const issues = loadIssues();
        issues.unshift(issue);
        saveIssues(issues);
        resetForm();
        render();
        window.scrollTo({ top: 0, behavior: "smooth" });
      });
    }

    function installFilterHandler() {
      document.getElementById("scopeFilter").addEventListener("change", render);
    }

    function installClearAllHandler() {
      document
        .getElementById("clearAllIssuesBtn")
        .addEventListener("click", () => {
          if (
            !confirm(
              "This will delete all issues and votes stored on this device for this app. Continue?"
            )
          ) {
            return;
          }
          saveIssues([]);
          render();
        });
    }

    function installExampleLoader() {
      document
        .getElementById("loadTermLimitsExampleBtn")
        .addEventListener("click", loadTermLimitsExample);
    }

    installTagChipHandlers();
    installFormHandler();
    installFilterHandler();
    installClearAllHandler();
    installExampleLoader();
    render();
  </script>
</body>
</html>
